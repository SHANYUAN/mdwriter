"use strict";function markMarkdownTrailingSpaces(stream){function singleTrailingSpace(){return stream.pos%2==0?"markdown-single-trailing-space-even":"markdown-single-trailing-space-odd"}if(!stream.string.length)return null;var eaten=stream.match(/.*[^ ]/);if(eaten)return null;if(stream.match(/ (?= +$)/))return singleTrailingSpace();var str=stream.string,len=str.length,twoTrailingSpaces=len>=2&&" "==str[len-2];return stream.eat(/./),twoTrailingSpaces?"markdown-line-break":singleTrailingSpace()}function storyTag(stream){return stream.string.length?stream.match(/story{/)||stream.match(/}story/)?"markdown-story":stream.match(/{(.*?)}/)?"markdown-definition":stream.match(/<!--(.*?)-->/)?"html-comment":stream.match(/^@title:.*/)?"metatag":stream.match(/^@author:.*/)?"metatag":stream.match(/^@created:.*/)?"metatag":stream.match(/^@updated:.*/)?"metatag":stream.match(/^@cover-description:.*/)?"metatag":stream.match(/^include\((.*)\)/m)?"include":void stream.eat(/./):null}angular.module("meanMarkdownApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.codemirror","ngDialog","ngCssInjector","sun.scrollable","angular.filter"]).config(["$routeProvider",function($routeProvider){$routeProvider.when("/",{redirectTo:"/login"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/files",{templateUrl:"views/files.html",controller:"MainCtrl"}).when("/editor/:id",{templateUrl:"views/editor.html",controller:"EditorCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("meanMarkdownApp").controller("MainCtrl",["$scope","$location","$routeParams","fileService","archivedFileService","ngDialog","AuthService","filetypeService","UserService","ActiveFileService",function($scope,$location,$routeParams,fileService,archivedFileService,ngDialog,AuthService,filetypeService,UserService,ActiveFileService){AuthService.isAuthenticated()||$location.path("/login"),$scope.init=function(){$scope.currentUser=AuthService.getUser(),$scope.group=AuthService.getUserGroup(),$scope.files=fileService.query(function(){$scope.appendActiveState()}),$scope.filetypes=filetypeService.getAll(),$scope.checkforfirefox()},$scope.appendActiveState=function(){ActiveFileService.query(function(activeFiles){$scope.files.forEach(function(file){var active=_.find(activeFiles,function(o){return o.fileID===file._id});active?file.active=active.users:file.active=[]})})},$scope.onCreateNewFile=function(){$scope.newFile={},ngDialog.open({template:"views/dialog_new_file.html",className:"smalldialog",disableAnimation:!0,closeByDocument:!0,scope:$scope})},$scope.onCreateConfirm=function(){var file={author:$scope.currentUser.name,title:$scope.newFile.title,type:$scope.newFile.type,markdown:"This is **markdown**.","private":$scope.newFile["private"]};fileService.save(file,function(file){$location.path("/editor/"+file._id)},function(){console.log("could not create new file!")})},$scope.onRemoveClick=function(id){ngDialog.openConfirm({template:"views/dialog_confirm_delete.html",className:"smalldialog",disableAnimation:!0,scope:$scope}).then(function(success){fileService.remove({id:id},function(){var index=_.findIndex($scope.files,{_id:id});$scope.files.splice(index,1),ngDialog.close("ngdialog1")})},function(){console.log("CANCELLED!")})},$scope.onDownloadClick=function(id){fileService.get({id:id},function(file){var blob=new Blob([file.markdown],{type:"data:text/plain;charset=utf-8;"}),downloadLink=angular.element("<a></a>");downloadLink.attr("href",window.URL.createObjectURL(blob)),downloadLink.attr("download","export.md"),downloadLink[0].click()})},$scope.onEditClick=function(id){fileService.get({id:id},function(file){$scope.file=file,ngDialog.open({template:"views/dialog_edit_file.html",className:"smalldialog",disableAnimation:!0,scope:$scope})})},$scope.onHistoryClick=function(id){archivedFileService.query({id:id},function(files){$scope.archivedFiles=files,ngDialog.open({template:"views/dialog_history.html",disableAnimation:!0,scope:$scope})})},$scope.hasArchived=[],$scope.checkIfArchivedFiles=function(id){archivedFileService.query({id:id},function(files){files.length>0&&$scope.hasArchived.push(id)})},$scope.onOpenAsNewFileClick=function(archivedFile){var file={author:$scope.currentUser.name,title:archivedFile.title+" (restored by "+$scope.currentUser.name+")",type:archivedFile.type,"private":archivedFile["private"],markdown:archivedFile.markdown,updated_by:$scope.currentUser.name};"OLAT"===file.type?file.type="opOlat":"presentation"===file.type&&(file.type="prMainzed"),fileService.save(file,function(file){$location.path("/editor/"+file._id)},function(){console.log("could not create new file!")})},$scope.onRevertFileClick=function(archivedFile){var file={author:archivedFile.author,title:archivedFile.title,type:archivedFile.type,"private":archivedFile["private"],markdown:archivedFile.markdown};fileService.update({id:archivedFile.fileID},file,function(){$scope.files=fileService.query()},function(){console.log("could not update file!")})},$scope.onSaveClick=function(file){fileService.update({id:file._id},file,function(file){$scope.files=fileService.query()},function(){console.log("could not update file!")})},$scope.onLogoutClick=function(){AuthService.logout()},$scope.getUsers=function(){UserService.query(function(users){$scope.users=users})},$scope.onUsersClick=function(){ngDialog.open({template:"views/dialog_users.html",disableAnimation:!0,scope:$scope})},$scope.onDeleteUserClick=function(id){UserService.remove({id:id},function(){var index=_.findIndex($scope.users,{_id:id});$scope.users.splice(index,1)})},$scope.onUserChange=function(user){UserService.update({id:user._id},user,function(){console.log("update of user: "+user.username+" successfull")})},$scope.isValidToolForType=function(filetype,toolname){return filetypeService.isValidToolForType(filetype,toolname)},$scope.isValidTypeForGroup=function(filetype,group){return filetypeService.isValidTypeForGroup(filetype,group)},$scope.getName=function(filetype){return filetypeService.getNameByType(filetype)},$("#maus").hover(function(){$(this).attr("src","../images/maussmile.svg")}),$("#maus").mouseleave(function(){$(this).attr("src","../images/maus.svg")}),$scope.checkforfirefox=function(){navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&alert("Bitte Chrome benutzen!!")},setInterval(function(){console.log("refreshing active files"),"/files"===$location.url()&&$scope.appendActiveState()},3e4)}]),angular.module("meanMarkdownApp").controller("EditorCtrl",["$scope","$location","$timeout","$routeParams","HTMLService","$document","$http","$filter","$window","fileService","AuthService","ngDialog","definitionService","filetypeService","ActiveFileService",function($scope,$location,$timeout,$routeParams,HTMLService,$document,$http,$filter,$window,fileService,AuthService,ngDialog,definitionService,filetypeService,ActiveFileService){AuthService.isAuthenticated()||$location.path("/login"),$scope.init=function(){$scope.currentUser=AuthService.getUser(),fileService.get({id:$routeParams.id},function(file){$scope.file=file,"news"===$scope.file.type&&"admin"!==$scope.currentUser.group&&$scope.editor.setOption("readOnly",!0),$scope.assets=filetypeService.getAssetsForFiletype(file.type),$scope.markFileAsActive()})},$scope.showSuccess=!1,$scope.showError=!1,$scope.editMode=!1,$scope.onCodeMirrorLoaded=function(_editor){$scope.editor=_editor},$scope.editorOptions={lineWrapping:!0,lineNumbers:!1,mode:"markdown",showTrailingSpace:!1,showMarkdownLineBreaks:!0,showOlatMarkdown:!0,scrollbarStyle:null},$scope.markFileAsActive=function(){ActiveFileService.query(function(activeFiles){var entry=_.find(activeFiles,function(o){return o.fileID===$scope.file._id});if(entry)-1===entry.users.indexOf($scope.currentUser.name)&&(entry.users.push($scope.currentUser.name),ActiveFileService.update({id:entry._id},entry,function(){console.log("updated active file!")}));else{var newActiveFile={fileID:$scope.file._id,users:[$scope.currentUser.name]};ActiveFileService.save(newActiveFile,function(){console.log("marked file as active!")})}})},$scope.markFileAsInactive=function(){ActiveFileService.query(function(activeFiles){var entry=_.find(activeFiles,function(o){return o.fileID===$scope.file._id});if(entry){var index=entry.users.indexOf($scope.currentUser.name);index>-1&&(entry.users.length>1?(entry.users.splice(index,1),ActiveFileService.update({id:entry._id},entry,function(){console.log("updated active file!")})):ActiveFileService["delete"]({id:entry._id},function(){console.log("removed active file!")}))}})},$scope.onSaveClick=function(){var id=$scope.file._id;"OLAT"===$scope.file.type?$scope.file.type="opOlat":"presentation"===$scope.file.type&&($scope.file.type="prMainzed");var newFile={author:$scope.file.author,markdown:$scope.file.markdown,type:$scope.file.type,title:$scope.file.title,"private":$scope.file["private"],updated_by:$scope.currentUser.name};fileService.update({id:id},newFile,function(){$scope.unsavedChanges=!1,$scope.showSuccess=!0,$timeout(function(){$scope.showSuccess=!1},3e3)},function(){$scope.showError=!0,$timeout(function(){$scope.showError=!1},3e3)})},$scope.onFilesClick=function(){$scope.unsavedChanges?ngDialog.openConfirm({template:"views/dialog_confirm_home.html",className:"smalldialog",scope:$scope}).then(function(success){$scope.markFileAsInactive(),$location.path("/files")},function(error){}):($scope.markFileAsInactive(),$location.path("/files"))},$scope.addSnippet=function(snippet){$scope.editor.replaceSelection(snippet),$scope.editor.focus()},$scope.addDefinition=function(definition){var snippet="{definition: "+definition.word+"}";$scope.addSnippet(snippet)},$scope.addStory=function(definition){var snippet="{story: "+definition.word+"}";$scope.addSnippet(snippet)},$scope.addImage=function(definition){var snippet="{picture: "+definition.word+"}";$scope.addSnippet(snippet)},$scope.addCitation=function(definition){var snippet="{citation: "+definition.word+"}";$scope.addSnippet(snippet)},$scope.onLabelClick=function(){var snippet="[I'm a Label](http://labeling.i3mainz.hs-mainz.de/label/#ec25d32d-3c1a-4539-9755-9bc63c17d989)";$scope.addSnippet(snippet)},$scope.onLinkClick=function(){var snippet="[I'm a link](https://www.google.com)";$scope.addSnippet(snippet)},$scope.onImageClick=function(){var snippet='![image-alt](bilder/filname.jpg "caption; author; license; url")';$scope.addSnippet(snippet)},$scope.onStoryScriptClick=function(){var snippet,selection=$scope.editor.getSelection();snippet=selection.length?"\nstory{\n\n"+selection+"\n\n}story\n":"\nstory{\n\nWrite **normal** markdown inside *storyscript* tags\n\n}story\n",$scope.addSnippet(snippet)},$scope.onExportClick=function(){$scope.filename=$scope.file.title.replace(/\s/g,"_")+".html",ngDialog.open({template:"views/dialog_export.html",className:"smalldialog",disableAnimation:!0,scope:$scope})},$scope.onDownloadConfirm=function(filename,addTitle,addContentTable,addImages,addLinks,addDefinitions,isFolder){var html,config={addTitle:addTitle,addContentTable:addContentTable,addImagesTable:addImages,addDefinitionsTable:addDefinitions};definitionService.query(function(definitions){fileService.query(function(files){var markdown=$scope.processIncludes($scope.file.markdown,files);$scope.fileCopy=angular.copy($scope.file),$scope.fileCopy.markdown=markdown,"opOlat"===$scope.file.type?(html=HTMLService.getOlat($scope.fileCopy,definitions,config),html=HTMLService.wrapOlatHTML(html,$scope.file.title,isFolder)):"opMainzed"===$scope.file.type&&(html=HTMLService.getOpMainzed($scope.fileCopy,definitions));var blob=new Blob([html],{type:"data:text/plain;charset=utf-8;"}),downloadLink=angular.element("<a></a>");downloadLink.attr("href",window.URL.createObjectURL(blob)),downloadLink.attr("download",filename),downloadLink[0].click()})})},$scope.onUndoClick=function(){$scope.editor.undo()},$scope.onRedoClick=function(){$scope.editor.redo()},$scope.onPreviewClick=function(){fileService.query(function(files){var markdown=$scope.processIncludes($scope.file.markdown,files);$scope.fileCopy=angular.copy($scope.file),$scope.fileCopy.markdown=markdown,$scope.processHtml($scope.fileCopy,function(previewPath){$scope.previewPath=previewPath,$scope.openDesktopPreview()})})},$scope.processHtml=function(file,success){var config={addTitle:!0,addContentTable:!0,addImagesTable:!0,addDefinitionsTable:!0};definitionService.query(function(definitions){var html;"opOlat"===$scope.file.type?(html=HTMLService.getOlat(file,definitions,config),html=HTMLService.wrapOlatHTML(html,file.title)):"opMainzed"===$scope.file.type?html=HTMLService.getOpMainzed(file,definitions):"prMainzed"===$scope.file.type&&(html=HTMLService.getPrMainzed(file),html=HTMLService.wrapPrMainzedHTML(html,file.title));var postData={type:file.type,html:html,user_id:$scope.currentUser._id};$http.post("/api/savepreview",postData).then(function(data){success(data.data.previewPath)},function(){console.log("something went wrong while trying to create preview")})})},$scope.openDesktopPreview=function(){ngDialog.open({template:"views/dialog_preview.html",disableAnimation:!0,closeByDocument:!0,scope:$scope})},$scope.openMobilePreview=function(){ngDialog.open({template:"views/dialog_preview.html",disableAnimation:!0,closeByDocument:!0,className:"ngdialog-theme-default preview-mobile",scope:$scope})},$scope.onMobileClick=function(){ngDialog.open({template:"views/dialog_preview.html",disableAnimation:!0,closeByDocument:!0,className:"ngdialog-theme-default mobile-view",scope:$scope})},$scope.onEditorChange=function(){$scope.unsavedChanges=!0},$scope.onDefinitionClick=function(){ngDialog.open({template:"views/dialog_definitions.html",scope:$scope,disableAnimation:!0,preCloseCallback:function(){$scope.onApplyDefinitionChanges(),$scope.editMode=!1}})},$scope.getDefinitions=function(){$scope.definitions=definitionService.query()},$scope.onRemoveDefinitionClick=function(id){definitionService.remove({id:id},function(){var index=_.findIndex($scope.definitions,{_id:id});$scope.definitions.splice(index,1)})},$scope.onApplyDefinitionChanges=function(){$scope.definitions.forEach(function(definition){definition._id?("picture"===definition.category&&console.log(definition),definitionService.update({id:definition._id},definition)):definitionService.save(definition)})},$scope.onCreateDefinitionClick=function(category){var timestmap=$filter("date")(new Date,"yyyy-MM-ddTHH:mm:ss.sssZ","CEST");$scope.definitions.push({filetype:$scope.file.type,category:category,updated_at:timestmap})},$scope.processIncludes=function(markdown,files){var includes=markdown.match(/include\((.*)\)/g);if(includes)for(var i=0;i<includes.length;i++)for(var filename=includes[i].match(/include\((.*)\)/m)[1],j=0;j<files.length;j++){var file=files[j];if(file.title.toLowerCase().trim()===filename.toLowerCase().trim()&&file.markdown){markdown=markdown.replace(includes[i],file.markdown);break}}return markdown},$scope.onHelpClick=function(){$window.open("https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet","_blank")},$scope.isValidToolForType=function(filetype,toolname){return filetypeService.isValidToolForType(filetype,toolname)},$(document).keydown(function(e){var code=e.keyCode||e.which;e.ctrlKey&&76===code&&(console.log("Ctrl + L"),$scope.onLinkClick(),e.preventDefault())}),$(document).keydown(function(e){var code=e.keyCode||e.which;e.ctrlKey&&73===code&&(console.log("Ctrl + I"),$scope.onImageClick(),e.preventDefault())}),$(document).keydown(function(e){var code=e.keyCode||e.which;e.ctrlKey&&83===code&&(console.log("Ctrl + S"),$scope.onSaveClick(),e.preventDefault())}),$(document).keydown(function(e){var code=e.keyCode||e.which;e.ctrlKey&&90===code&&(console.log("Ctrl + Z"),$scope.onUndoClick(),e.preventDefault())}),$(window).resize(function(){});document.getElementsByTagName("body")[0];window.addEventListener("mousemove",function(){}),$(window).bind("beforeunload",function(){return"It seems like you made unsaved changes to your document. Are you sure you want to leave without saving?"})}]),angular.module("meanMarkdownApp").factory("fileService",["$http","$resource",function($http,$resource){return $resource("/api/files/:id",null,{update:{method:"PUT"}})}]),angular.module("meanMarkdownApp").factory("definitionService",["$http","$resource",function($http,$resource){return $resource("/api/definitions/:id",null,{update:{method:"PUT"}})}]),CodeMirror.defineOption("showMarkdownLineBreaks",!1,function(codeMirror,newValue,oldValue){oldValue==CodeMirror.Init&&(oldValue=!1),oldValue&&!newValue?codeMirror.removeOverlay("show-markdown-line-breaks"):!oldValue&&newValue&&codeMirror.addOverlay({name:"show-markdown-line-breaks",token:markMarkdownTrailingSpaces})}),CodeMirror.defineOption("showOlatMarkdown",!1,function(codeMirror,newValue,oldValue){oldValue===CodeMirror.Init&&(oldValue=!1),oldValue&&!newValue?codeMirror.removeOverlay("show-olat-markdown"):!oldValue&&newValue&&codeMirror.addOverlay({name:"show-olat-markdown",token:storyTag})}),angular.module("meanMarkdownApp").service("HTMLService",["definitionService","filetypeService","MetadataService",function(definitionService,filetypeService,MetadataService){function getPictureString(enrichment){var figureString,authorString="",licenseString="",metadataString="";return enrichment.author&&(authorString='<span class="author">Autor: '+enrichment.author+"</span>"),enrichment.license&&(licenseString='<span class="license">Lizenz: '+enrichment.license+"</span>"),enrichment.title||(console.log("missing image alt attribute"),enrichment.title="picture"),(authorString||licenseString)&&(metadataString=['<div class="picture-metadata">',authorString,licenseString,"</div>"].join("")),figureString=['<figure id="'+enrichment._id+'">','<img src="'+enrichment.url+'" class="picture" alt="'+enrichment.title+'">',"<figcaption>",enrichment.text,metadataString,"</figcaption>","</figure>"].join("")}function getDefinitionFootnoteString(enrichment){var metadataString,authorString="",websiteString="";return enrichment.author&&(authorString='<span class="author">Autor: '+enrichment.author+"</span>"),enrichment.url&&(websiteString=['<span class="website">','<a href="'+enrichment.url+'" target="_blank">Website</a>',"</span>"].join("")),(authorString||websiteString)&&(metadataString=['<div class="definition-metadata">',authorString,websiteString,"</div>"].join("")),metadataString}this.getOlat=function(file,definitions,config){config=config||{addTitle:!1,addContentTable:!1,addDefinitionsTable:!1,addImagesTable:!1};var html=this.convertOpOlatMarkdownToHTML(file.markdown),page=$("<div>"+html+"</div>");return this.replaceStoryTags(page),this.replaceEnrichmentTags(page,definitions),config.addImagesTable&&this.createImagesTable(page),config.addDefinitionsTable&&this.createDefinitionsTable(page),config.addContentTable&&this.createOpOlatNavigation(page),config.addTitle&&$(page).prepend('<h1 class="page-title" id="page-title">'+file.title+"</h1>"),$(page).html()},this.getPrMainzed=function(file){var customRenderer=new marked.Renderer,counter=0;customRenderer.heading=function(text,level){counter++;var closeDiv="";return counter>1&&(closeDiv="</div>"),'<div class="slide" id="slide'+counter+'">\n<h'+level+' id="h'+level+"-"+counter+'">'+text+"</h"+level+">\n"};var html=marked(file.markdown,{renderer:customRenderer});return html+="</div>"},this.getOpMainzed=function(file,definitions){var metadata=MetadataService.getAndReplace(file.markdown),htmlString='<div id="ressourceswrapper"><div id="imagecontainer"></div><div id="ressources"><span id="navicon"><span class="icon-toc"></span></span><span id="closeicon"><span class="icon-close"></span></span><div id="titletextbg"><h1 class="titletext title">'+metadata.title+'</h1><a class="start titletext" href="#read">Jetzt lesen</a></div><div id="gradient"></div><ul id="nav"></ul>\n<div id="ressourcestext"></div></div></div><div id="read"></div>\n<div id=\'footnotes\'></div>\n',page=$("<div>"+htmlString+"</div>"),html=this.convertOpMainzedMarkdownToHTML(metadata.markdown);return $("#read",page).append(html),this.createOpMainzedNavigation(page),this.replaceEnrichmentTags(page,definitions),this.wrapOpMainzedHTML(page.html(),metadata)},this.getOpMainzed2=function(file,definitions){var metadata=MetadataService.getAndReplace(file.markdown),conversion=new OpOlatConversion;conversion.appendToPage([].join(""));var htmlString='<div id="ressourceswrapper"><div id="imagecontainer"></div><div id="ressources"><span id="navicon"><span class="icon-toc"></span></span><span id="closeicon"><span class="icon-close"></span></span><div id="titletextbg"><h1 class="titletext title">'+metadata.title+'</h1><a class="start titletext" href="#read">Jetzt lesen</a></div><div id="gradient"></div><ul id="nav"></ul>\n<div id="ressourcestext"></div></div></div><div id="read"></div>\n<div id=\'footnotes\'></div>\n',page=$("<div>"+htmlString+"</div>"),html=this.convertOpMainzedMarkdownToHTML(metadata.markdown);return $("#read",page).append(html),this.createOpMainzedNavigation(page),this.replaceEnrichmentTags(page,definitions),this.wrapOpMainzedHTML(page.html(),metadata)},this.wrapOlatHTML=function(html,title,isFolder){var stylePath;return stylePath=isFolder?"../style/olat.css":"style/olat.css",'<!DOCTYPE html>\n<html lang="de">\n<head>\n<title>'+title+'</title>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<meta property="dc:creator" content="Kai Christian Bruhn, Matthias Dufner, Thomas Engel, Axel Kunz" />\n<link rel="stylesheet" href="'+stylePath+'">\n</head>\n<body>\n'+html+'\n<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>\n<script src="javascript/app.js"></script>\n</body>\n</html>'},this.wrapPrMainzedHTML=function(html,title){return'<!DOCTYPE html>\n<html lang="de">\n<head>\n<title>'+title+'</title>\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n<meta property="dc:creator" content="Kai Christian Bruhn, Matthias Dufner, Thomas Engel, Axel Kunz" />\n<link rel="stylesheet" href="style/prmainzed.css">\n</head>\n<body>\n'+html+'\n<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>\n<script src="javascript/app.js"></script>\n</body>\n</html>'},this.wrapOpMainzedHTML=function(html,metadata){return'<!DOCTYPE html>\n<html lang="de">\n<head>\n<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>'+metadata.title+'</title>\n<link rel="stylesheet" href="style/reader.css">\n<link rel="stylesheet" href="style/style.css">\n<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:700|Roboto:400,400i,700" rel="stylesheet"><META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW"></head>\n<body>\n<div id="titlepicture"><p class="coverdescription titletext">'+metadata.coverDescription+'</p></div><div id="scrollmarker"></div>'+html+'<div id="imprint"><h3>Impressum</h3><p>Angaben gemäß § 5 TMG:</p><div class="address" about="#mainzed" typeof="foaf:Organization"><span class="organisationnameimprint" property="foaf:name">mainzed - Mainzer Zentrum für Digitalit&auml;t in den Geistes- und Kulturwissenschaften			</span><br><div rel="vcard:hasAddress"><address>c/o Hochschule Mainz University of Applied Sciences<br><div property="vcard:street-address">Lucy-Hillebrandtstr.2</div><span property="vcard:postal-code">55128</span> <span property="vcard:locality">Mainz</span>, <span property="vcard:country-name">Germany</span></address></div></div><div class="persons"><div>Herausgeber: Kai-Christian Bruhn</div><div>Redaktion: Anne Klammt</div><div>Gestaltung: Matthias Dufner mit Axel Kunz und Sarah Pittroff</div></div><div>PDF DOI #####</div></div><script src="https://code.jquery.com/jquery-2.2.3.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.nanoscroller/0.8.7/javascripts/jquery.nanoscroller.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.0/jquery.waypoints.min.js"></script><script src="javascript/app.js"></script><script src="javascript/markactive.js"></script><script src="javascript/hyphenate.js"></script></body>\n</html>'},this.convertOpMainzedMarkdownToHTML=function(markdown){var customRenderer=new marked.Renderer,h1Counter=0,h2Counter=0,h3Counter=0;return customRenderer.heading=function(text,level){return 1===level?(h1Counter++,h2Counter=0,h3Counter=0,'<h1 id="section-'+h1Counter+'" class="hyphenate">'+text+"</h1>\n"):2===level?(h2Counter++,h3Counter=0,'<h2 id="section-'+h1Counter+"-"+h2Counter+'" class="hyphenate">'+text+"</h2>\n"):3===level?(h3Counter++,'<h3 id="section-'+h1Counter+"-"+h2Counter+"-"+h3Counter+'" class="hyphenate">'+text+"</h3>\n"):void 0},customRenderer.link=function(linkUrl,noIdea,text){return linkUrl.startsWith("#")?'<a href="'+linkUrl+"\" class='internal-link'>"+text+"</a>":'<a href="'+linkUrl+'" class=\'external-link\' target="_blank">'+text+"</a>"},marked(markdown,{renderer:customRenderer})},this.convertOpOlatMarkdownToHTML=function(markdown){var customRenderer=new marked.Renderer,counter=0;customRenderer.heading=function(text,level){return counter++,"<h"+level+' id="h'+level+"-"+counter+'">'+text+"</h"+level+">\n"},customRenderer.link=function(linkUrl,noIdea,text){return'<a href="'+linkUrl+'" target="_blank">'+text+"</a>"};var ImageCounter=1;return customRenderer.image=function(src,title,alt){var tokens=title.split("; "),caption=tokens[0].replace(/\\/g,""),preCaption="Abb."+ImageCounter;return ImageCounter++,'<figure id="'+alt+'">\n<img src="'+src+'" alt="'+alt+'" ><figcaption>\n'+preCaption+"<br>"+caption+'<br><a href="#images-table">\n(Quelle)\n</a>\n</figcaption>\n</figure>\n'},marked(markdown,{renderer:customRenderer})},this.replaceEnrichmentTags=function(page,enrichments){var me=this,usedEnrichments=[],tags=$(page).html().match(/\{(.*?)\}/g);tags&&tags.forEach(function(tag){var category,shortcut,content=tag.replace("{","").replace("}","");content.split(":").length>1?(category=content.split(":")[0].trim(),shortcut=content.split(":")[1].trim()):(category="definition",shortcut=content);var enrichment;"picturegroup"===category?me.replacePictureGroup(page,shortcut,enrichments,tag):"picture"===category?(enrichment=me.findEnrichmentByShortcut(enrichments,shortcut),enrichment&&me.replacePicture(tag,page,enrichment)):"citation"===category?(enrichment=me.findEnrichmentByShortcut(enrichments,shortcut),enrichment&&me.replaceCitation(page,enrichment,tag)):"definition"===category?me.replaceDefinition(page,shortcut,tag,enrichments,usedEnrichments):"story"===category&&(enrichment=me.findEnrichmentByShortcut(enrichments,shortcut),enrichment&&me.replaceStory(page,enrichment,tag))})},this.replacePictureGroup=function(page,shortcut,enrichments,tag){if(shortcut.length<2)throw console.log("Picturegroup needs at least two pictures."),Error("Picturegroup needs at least two pictures.");var me=this,previousHTML=$("#read",page).html();$("#read",page).html(previousHTML.replace(tag,"<div class='picturegroup'></div>"));var shortcuts=shortcut.split(",");shortcuts.forEach(function(shortcut){var picture=shortcut.trim(),enrichment=me.findEnrichmentByShortcut(enrichments,picture);if(enrichment){var pictureString=getPictureString(enrichment);$(".picturegroup",page).last().append(pictureString)}else console.log("Picture '"+shortcut+"' not found!")})},this.replacePicture=function(tag,page,enrichment){"opMainzed"!==enrichment.filetype&&console.log("filetype "+enrichment.filetype+"currently does not support picture tags");var pictureString=getPictureString(enrichment),currentHTML=$("#read",page).html();$("#read",page).html(currentHTML.replace(tag,pictureString))},this.replaceCitation=function(page,enrichment,tag){enrichment.text&&enrichment.author||console.log("text or author missing for enrichment: "+enrichment.word);var currentHTML=$("#read",page).html();currentHTML.length<1&&console.log("No div with id #read found in page");var citationString='<div class="citation hyphenate">'+marked(enrichment.text)+'<span class="author">'+enrichment.author+"</span></div>";$("#read",page).html(currentHTML.replace(tag,citationString))};var storyCounter=1;this.replaceStory=function(page,enrichment,tag){if("opOlat"!==enrichment.filetype)throw console.log("filetype: "+enrichment.filetype+" does not support the usage of story-tags"),Error("filetype: "+enrichment.filetype+" does not support the usage of story-tags");var currentHTML=$(page).html(),storyString=['<div class="story">',marked(enrichment.text),"</div>"].join("");storyCounter++,$(page).html(currentHTML.replace(tag,storyString))},this.replaceDefinition=function(page,shortcut,tag,enrichments,usedEnrichments){var currentHTML,snippet,enrichment,customWord,customWords=shortcut.match(/".*"/);if(customWords&&(shortcut=shortcut.replace(customWords[0],"").trim(),customWord=customWords[0].replace('"',"").replace('"',"")),enrichment=this.findEnrichmentByShortcut(enrichments,shortcut)){if("opOlat"===enrichment.filetype?(currentHTML=$(page).html(),snippet=['<a href="#definitions-table" title="',enrichment.text,'" class="definition">',customWord||enrichment.word,"</a>"].join(""),$(page).html(currentHTML.replace(tag,snippet))):"opMainzed"===enrichment.filetype&&(currentHTML=$("#read",page).html(),snippet=['<span id="',enrichment._id,'" class="shortcut">',customWord||enrichment.word,"</span>"].join(""),$("#read",page).html(currentHTML.replace(tag,snippet))),"opMainzed"===enrichment.filetype&&-1===usedEnrichments.indexOf(enrichment._id)){var customRenderer=new marked.Renderer;customRenderer.link=function(linkUrl,noIdea,text){return 0===linkUrl.indexOf("#")?'<a href="'+linkUrl+'" class="internal-link">'+text+"</a>":'<a href="'+linkUrl+'" class="external-link" target="_blank">'+text+"</a>"};var html=marked(enrichment.text,{renderer:customRenderer}),metadataString=getDefinitionFootnoteString(enrichment);$("#footnotes",page).append(['<div class="'+enrichment._id+'">',"<h4>"+enrichment.word+"</h4>",html,metadataString,"</div>"].join(""))}-1===usedEnrichments.indexOf(enrichment._id)&&usedEnrichments.push(enrichment._id)}},this.replaceDefinitionTags=function(page,enrichments){return this.replaceEnrichmentTags(page,enrichments)},this.findEnrichmentByShortcut=function(enrichments,shortcut){var result;return enrichments.forEach(function(enrichment){enrichment.word===shortcut&&(result=enrichment)}),result},this.replaceStoryTags=function(page){var html=$(page).html(),matches=html.match(/story{/g),counter=1;if(matches)for(var i=0;i<matches.length;i++)html=html.replace(/<p>story{<\/p>/,'<div class="story" id="story'+counter+'">'),counter++;html=html.replace(/<p>}story<\/p>/g,"</div>"),$(page).html(html)},this.createImagesTable=function(page){var figures=$("figure",page);figures.length>0&&($(page).append('<div id="images-table" class="images-table"><h4>Abbildungen</h4><ul></ul></div>'),figures.each(function(index){var caption=$(this).find("figcaption").text(),imageString="<li>Abb."+(index+1)+"<br>"+caption+"</li>";$("#images-table ul",page).append(imageString)}))},this.createDefinitionsTable=function(page){var definitions=$("a.definition",page);if(definitions.length>0){$(page).append('<div id="definitions-table" class="definitions-table">\n<h4>Glossar</h4>\n<ul></ul>\n</div>');var usedDefs=[];definitions.each(function(){if(-1===usedDefs.indexOf($(this).html())){var defString='<li><a href="#" target="_blank" class="definition" title="'+$(this).attr("title")+'">'+$(this).html()+"</a></li>";$("#definitions-table ul",page).append(defString),usedDefs.push($(this).html())}})}},this.createOpMainzedNavigation=function(page){var previousHeadingLevel;$("h1, h2",page).each(function(index){if(index>0){var headingString='<a href="#'+$(this).attr("id")+'">'+$(this).text()+"</a>";$(this).is("h1")?($("#nav",page).append("<li>"+headingString+"</li>"),previousHeadingLevel=1):$(this).is("h2")&&(1===previousHeadingLevel?$("#nav li",page).last().append("<ul><li>"+headingString+"</li></ul>"):2===previousHeadingLevel&&$("#nav ul",page).last().append("<li>"+headingString+"</li>"),
previousHeadingLevel=2)}}),$("ul#nav",page).prepend('<li><a href="#titlepicture">Cover</a></li>'),$("ul#nav",page).append('<li><a href="#imprint">Impressum</a></li>')},this.createOpOlatNavigation=function(page){var headers=$("h1",page),stories=$(".story",page),images=$("#images-table",page),definitions=$("#definitions-table",page);$(page).prepend('<div id="headings-table" class="headings-table"><ul></ul></div>'),$("#page-title",page).length>0&&($("#headings-table ul",page).append('<li><a href="#page-title">Top</a></li>'),$("#headings-table ul",page).append('<li class="seperator"></li>')),headers.each(function(){var headingsString='<li><a href="#'+$(this).attr("id")+'">'+$(this).text()+"</a></li>";$("#headings-table ul",page).append(headingsString)}),stories.length>0&&$("#headings-table ul",page).append('<li class="seperator"></li>'),stories.each(function(index){var storyString='<li class="story"><a href="#'+$(this).attr("id")+'">Story Teil '+(index+1)+"</a></li>";$("#headings-table ul",page).append(storyString)}),(images.length>0||definitions.length>0)&&$("#headings-table ul",page).append('<li class="seperator"></li>'),images.length>0&&$("#headings-table ul",page).append('<li><a href="#images-table">Abbildungen</a></li>'),definitions.length>0&&$("#headings-table ul",page).append('<li><a href="#definitions-table">Glossar</a></li>')}}]),angular.module("meanMarkdownApp").factory("archivedFileService",["$resource",function($resource){return $resource("/api/archivedfiles/:id",null,{update:{method:"PUT"}})}]),angular.module("meanMarkdownApp").controller("LoginCtrl",["$scope","$location","$timeout","AuthService",function($scope,$location,$timeout,AuthService){AuthService.isAuthenticated()&&$location.path("/files"),$scope.onLoginSubmit=function(){$scope.validating=!0,AuthService.login($scope.username,$scope.password,function(){$location.path("/files"),$scope.validating=!1},function(){$scope.showError="wrong username or password",$timeout(function(){$scope.showError=!1},3e3),$scope.validating=!1})},$scope.onSignupSubmit=function(){$scope.validating=!0,$scope.password===$scope.passwordConfirm?AuthService.signup($scope.username,$scope.password,function(user){$location.path("/files"),$scope.validating=!1},function(res){$scope.showError=res.message,$timeout(function(){$scope.showError=!1},3e3),$scope.validating=!1}):($scope.showError="passwords do not match!",$timeout(function(){$scope.showError=!1},3e3),$scope.validating=!1,$scope.passwordConfirm="")},$(document).keydown(function(e){var code=e.keyCode||e.which;13!==code||$scope.showSignup||$("#login-button").attr("disabled")||$("#login-button").click()})}]),angular.module("meanMarkdownApp").service("AuthService",["$cookieStore","$location","$http","UserService",function($cookieStore,$location,$http,UserService){this.getUser=function(){return $cookieStore.get("currentUser")},this.getUserGroup=function(){return $cookieStore.get("currentUser").group},this.isAuthenticated=function(){return!!$cookieStore.get("currentUser")},this.login=function(username,password,success,failure){var data={username:username,password:password};$http.post("/auth/login",data).then(function(res){null!==res.data.user&&"success"===res.data.state?($cookieStore.put("currentUser",{name:res.data.user.username,group:res.data.user.group,_id:res.data.user._id}),success(res.data.user)):failure("password or username incorrect!")},function(res){failure("could not connect to server!")})},this.signup=function(username,password,success,failure){UserService.query(function(users){var exists=_.find(users,function(user){return user.username===username});if(exists)failure({message:"user already exists!"});else{var data={username:username,password:password};$http.post("/auth/signup",data).then(function(res){null!==res.data.user&&"success"===res.data.state?($cookieStore.put("currentUser",{name:res.data.user.username,_id:res.data.user._id}),success(res.data.user)):failure({message:"something went wrong when trying to signup a new user!"})},function(){failure({message:"could not complete signup request!"})})}},function(){failure({message:"could not connect to users db!"})})},this.logout=function(){$cookieStore.remove("currentUser"),$location.path("/login")}}]),angular.module("meanMarkdownApp").directive("msFilesPanel",["$filter",function($filter){return{templateUrl:"views/files-panel.html",restrict:"E",link:function(scope,element,attrs){scope.currentFileType=attrs.filetype,scope.groupHasValidFiles=function(key){var hasValid=!1;return scope.files.forEach(function(file){file.type!==key||file.author!==scope.currentUser.name&&file["private"]!==!1||(hasValid=!0)}),hasValid},scope.getFormattedDate=function(timestamp){var format="dd.MM.yyyy",timezone="CEST",date=$filter("date")(timestamp,format,timezone),today=$filter("date")(new Date,format,timezone),yesterday=$filter("date")(new Date-1,format,timezone);return date===today?"Heute ":date===yesterday?"Gestern":date},scope.setFilter=function(query){if(query.updated_at){var timestamp=query.updated_at;scope.currentFilter={updated_at:timestamp.substring(0,10)}}else scope.currentFilter=query},scope.onResetClick=function(){scope.currentFilter=void 0}}}}]),angular.module("meanMarkdownApp").directive("msEditorToolbar",function(){return{templateUrl:"views/editor-toolbar.html",restrict:"E",link:function(scope,element,attrs){}}}),angular.module("meanMarkdownApp").directive("focusOnVisibility",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){scope.$watch(attrs.ngShow,function(newValue){newValue===!0&&$timeout(function(){element.focus()},0,!1)})}}}]),angular.module("meanMarkdownApp").directive("msTableInput",function(){return{templateUrl:"views/table-input.html",restrict:"E",scope:{bindModel:"=ngModel"},link:function(scope,element,attrs){scope.showTextarea=!1}}}),angular.module("meanMarkdownApp").directive("msFilterButton",function(){return{templateUrl:"views/filter-button.html",restrict:"E",link:function(scope,element,attrs){}}}),angular.module("meanMarkdownApp").service("filetypeService",function(){var filetypes=[{type:"opOlat",displayname:"OLAT",groups:["admin","look-diva","mainzed"],tools:[{name:"storytag"},{name:"imagetag"},{name:"linktag"}],assets:{definition:{html:'<a href="#definitions-table" title="${text}" class="definition">${word}</a>'},story:{html:'<div class="story" id="story${counter}">${text}</div>',title:"Zitate"}}},{type:"opMainzed",displayname:"Mainzed Jahresbericht",groups:["admin","mainzed","look-diva"],tools:[{name:"imagetag"},{name:"linktag"}],assets:{definition:{html:'<span id="${id}" class="shortcut">${word}</span>'},image:{},citation:{}}},{type:"prMainzed",displayname:"Mainzed Präsentation",groups:["admin","mainzed","look-diva"],tools:[]},{type:"news",displayname:"News",groups:["admin"],tools:[]}];this.getAll=function(){return filetypes},this.getNameByType=function(type){var obj=_.find(filetypes,function(item){return item.type===type});return obj?obj.displayname:void console.log("unknown filetype: "+type)},this.isValidToolForType=function(type,toolname){var obj,isValid=!1;return obj=_.find(filetypes,function(item){return item.type===type}),obj&&obj.tools.forEach(function(tool){tool.name===toolname&&(isValid=!0)}),isValid},this.getAssetsForFiletype=function(filetype){var obj=_.find(filetypes,function(item){return item.type===filetype});return obj.assets}}),angular.module("meanMarkdownApp").factory("UserService",["$http","$resource",function($http,$resource){return $resource("/api/users/:id",null,{update:{method:"PUT"}})}]),angular.module("meanMarkdownApp").directive("msCheckbox",function(){return{template:'<span>\n<i ng-show="checked === false" class="fa fa-square-o" aria-hidden="true" ng-click="checked = true"></i>\n<i ng-show="checked === true" class="fa fa-check-square-o" aria-hidden="true" ng-click="checked = false"></i>\n</span>',restrict:"E",scope:{ngModel:"="},link:function(scope,element,attrs){scope.$apply(function(){scope.checked=scope.ngModel}),element.bind("click",function(){scope.$apply(function(){scope.ngModel=scope.checked})})}}}),angular.module("meanMarkdownApp").directive("msDefinitionsTable",function(){return{templateUrl:"views/definitions-table.html",restrict:"E"}}),angular.module("meanMarkdownApp").directive("msImagesTable",function(){return{templateUrl:"views/images-table.html",restrict:"E"}}),angular.module("meanMarkdownApp").directive("msStoriesTable",function(){return{templateUrl:"views/stories-table.html",restrict:"E"}}),angular.module("meanMarkdownApp").directive("msCitationsTable",function(){return{templateUrl:"views/citations-table.html",restrict:"E"}}),angular.module("meanMarkdownApp").factory("Conversion",function(){function Conversion(filetype,markdown){this.filetype=filetype,this.markdown=markdown,this.page=$("<div></div>")}return Conversion.prototype.init=function(){},Conversion.prototype.appendToPage=function(content){this.page.append(content)},Conversion.prototype.getHtml=function(){return this.page.html()},Conversion.prototype.getMetadata=function(){var matches,markdown=this.markdown;matches=markdown.match(/^@title:(.*)/),matches&&(result.title=matches[1].trim(),markdown=markdown.replace(matches[0]+"\n","")),matches=markdown.match(/^@author:(.*)/),matches&&(result.author=matches[1].trim(),markdown=markdown.replace(matches[0]+"\n","")),matches=markdown.match(/^@created:(.*)/),matches&&(result.created=matches[1].trim(),markdown=markdown.replace(matches[0]+"\n","")),matches=markdown.match(/^@updated:(.*)/),matches&&(result.updated=matches[1].trim(),markdown=markdown.replace(matches[0]+"\n","")),matches=markdown.match(/^@cover-description:(.*)/),matches&&(result.coverDescription=matches[1].trim(),markdown=markdown.replace(matches[0]+"\n","")),this.markdown=markdown},Conversion}),angular.module("meanMarkdownApp").service("OpMainzedConversion",["Conversion",function(Conversion){function OpMainzedConversion(){Conversion.call(this,"opMainzed")}return OpMainzedConversion.prototype.getHtmlFromMarkdown=function(markdown){var customRenderer=new marked.Renderer,h1Counter=0,h2Counter=0,h3Counter=0;return customRenderer.heading=function(text,level){return 1===level?(h1Counter++,h2Counter=0,h3Counter=0,'<h1 id="section-'+h1Counter+'">'+text+"</h1>"):2===level?(h2Counter++,h3Counter=0,'<h2 id="section-'+h1Counter+"-"+h2Counter+'">'+text+"</h2>"):3===level?(h3Counter++,'<h3 id="section-'+h1Counter+"-"+h2Counter+"-"+h3Counter+'">'+text+"</h3>"):void 0},customRenderer.link=function(linkUrl,noIdea,text){return 0===linkUrl.indexOf("#")?'<a href="'+linkUrl+'" class="internal-link">'+text+"</a>":'<a href="'+linkUrl+'" class="external-link" target="_blank">'+text+"</a>"},marked(markdown,{renderer:customRenderer})},OpMainzedConversion}]),angular.module("meanMarkdownApp").service("MetadataService",function(){this.getAndReplace=function(markdown){var matches,result={},cleanMarkdown=markdown;return matches=cleanMarkdown.match(/^@title:(.*)/),matches&&(result.title=matches[1].trim(),cleanMarkdown=cleanMarkdown.replace(matches[0]+"\n","")),matches=cleanMarkdown.match(/^@author:(.*)/),matches&&(result.author=matches[1].trim(),cleanMarkdown=cleanMarkdown.replace(matches[0]+"\n","")),matches=cleanMarkdown.match(/^@created:(.*)/),matches&&(result.created=matches[1].trim(),cleanMarkdown=cleanMarkdown.replace(matches[0]+"\n","")),matches=cleanMarkdown.match(/^@updated:(.*)/),matches&&(result.updated=matches[1].trim(),cleanMarkdown=cleanMarkdown.replace(matches[0]+"\n","")),matches=cleanMarkdown.match(/^@cover-description:(.*)/),matches&&(result.coverDescription=matches[1].trim(),cleanMarkdown=cleanMarkdown.replace(matches[0]+"\n","")),result.markdown=cleanMarkdown,result}}),angular.module("meanMarkdownApp").factory("ActiveFileService",["$resource",function($resource){return $resource("/api/activefiles/:id",null,{update:{method:"PUT"}})}]),angular.module("meanMarkdownApp").run(["$templateCache",function($templateCache){$templateCache.put("views/citations-table.html",'<table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 5%"> <col span="1" style="width: 10%"> <col span="1" style="width: 70%"> <col span="1" style="width: 10%"> <col span="1" style="width: 5%"> </colgroup> <thead> <tr class="noborder"> <th></th> <th>Shortcut</th> <th>Text</th> <th>Author</th> <th></th> </tr> </thead> </table> <scrollable> <table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 5%"> <col span="1" style="width: 10%"> <col span="1" style="width: 70%"> <col span="1" style="width: 10%"> <col span="1" style="width: 5%"> </colgroup> <tbody> <!--<tr ng-repeat="definition in definitions | filter:{ filetype: file.type }| filter:filterBox | orderBy: \'-updated_at\'">--> <tr ng-repeat="definition in definitions | filter: {category: category, filetype: file.type} | filter:filterBox |  orderBy: \'-updated_at\'"> <td> <a ng-click="closeThisDialog(); addCitation(definition)" class="choose"> <i class="fa fa-play" aria-hidden="true"></i> </a> </td> <td> <!-- new definition --> <textarea ng-show="showNewFocus && $index === 0 && !definition._id" type="text" placeholder="Word" ng-model="definition.word" class="form-control" ng-blur="showNewFocus = false" focus-on-visibility></textarea> <!-- existing definition --> <ms-table-input ng-show="!showNewFocus || $index > 0 || definition._id" ng-model="definition.word"></ms-table-input> </td> <td> <ms-table-input ng-model="definition.text"></ms-table-input> </td> <td> <ms-table-input ng-model="definition.author"></ms-table-input> </td> <!-- remove --> <td ng-show="definition._id"> <button type="button" class="btn btn-default" ng-click="onRemoveDefinitionClick(definition._id)"> <span class="icon-trash"></span> </button> </td> </tr><!-- end repeat --> </tbody> </table> </scrollable>'),$templateCache.put("views/definitions-table.html",'<table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 5%"> <col span="1" style="width: 20%"> <col span="1" style="width: 45%"> <col span="1" style="width: 15%"> <col span="1" style="width: 10%"> <col span="1" style="width: 5%"> </colgroup> <thead> <tr class="noborder"> <th></th> <!-- Erste Spalte --> <!--<th ng-show="file.type === \'opMainzed\'">Shortcut</th>--> <th>Shortcut</th> <th>Definition</th> <!--<th ng-show="file.type !== \'opMainzed\'">Source</th>--> <th>Source/Author</th> <th>Website</th> <th></th> </tr> </thead> </table> <scrollable> <table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 5%"> <col span="1" style="width: 20%"> <col span="1" style="width: 45%"> <col span="1" style="width: 15%"> <col span="1" style="width: 10%"> <col span="1" style="width: 5%"> </colgroup> <tbody> <!--<tr ng-repeat="definition in definitions | filter:{ filetype: file.type }| filter:filterBox | orderBy: \'-updated_at\'">--> <tr ng-repeat="definition in definitions | filter: {category: category, filetype: file.type} | filter:filterBox |  orderBy: \'-updated_at\'"> <td> <a ng-click="closeThisDialog(); addDefinition(definition)" class="choose"> <i class="fa fa-play" aria-hidden="true"></i> </a> </td> <td> <!-- new definition --> <textarea ng-show="showNewFocus && $index === 0 && !definition._id" type="text" placeholder="Word" ng-model="definition.word" class="form-control" ng-blur="showNewFocus = false" focus-on-visibility></textarea> <!-- existing definition --> <ms-table-input ng-show="!showNewFocus || $index > 0 || definition._id" ng-model="definition.word"></ms-table-input> </td> <td> <ms-table-input ng-model="definition.text"></ms-table-input> </td> <td> <input type="text" placeholder="Source" ng-model="definition.author" ng-class="authorClass" ng-init="authorClass = [\'def-table-entries\']" ng-blur="authorClass = [\'def-table-entries\']" ng-focus="authorClass = [\'form-control\']" ng-change="onDefinitionChange()"> </td> <td> <input type="text" placeholder="Website" ng-model="definition.url" ng-class="urlClass" ng-init="urlClass = [\'def-table-entries\']" ng-blur="urlClass = [\'def-table-entries\']" ng-focus="urlClass = [\'form-control\']" ng-change="onDefinitionChange()"> </td> <!-- remove --> <td ng-show="definition._id"> <button type="button" class="btn btn-default" ng-click="onRemoveDefinitionClick(definition._id)"> <span class="icon-trash"></span> </button> </td> </tr><!-- end repeat --> </tbody> </table> </scrollable>'),$templateCache.put("views/dialog_confirm_delete.html",'<p> Are you sure?<br><br> This will permanently delete this file. </p><p> <button type="button" ng-click="confirm()" class="btn btn-sm center-block bluebutton">Confirm</button></p>'),$templateCache.put("views/dialog_confirm_home.html",'<p> Unsaved changes to your file may be lost! Press cancel and save your changes or continue without saving? </p> <button type="button" class="btn btn-default btn-sm bluebutton center-block" ng-click="confirm()">Continue Anyway</button> <!-- <button type="button" class="btn btn-default btn-sm">Save changes and continue</button> -->'),$templateCache.put("views/dialog_confirm_refresh.html",'<p> It looks like you have unsaved changes! Are you sure you want to leave the page? Unsaved changes to your file may be lost! </p> <button type="button" class="btn btn-danger btn-sm" ng-click="confirm()">Leave Anyway</button> <button type="button" class="btn btn-default btn-sm" ng-click="closeThisDialog()">Cancel</button> <!-- <button type="button" class="btn btn-default btn-sm">Save changes and continue</button> -->'),$templateCache.put("views/dialog_definitions.html",'<!--<span class="tableheader fullwidth">Definitions</span>--> <button type="button" class="btn btn-default" ng-click="category = \'definition\'" ng-show="assets.definition">Definitionen</button> <button type="button" class="btn btn-default" ng-click="category = \'picture\'" ng-show="assets.image">Bilder</button> <button type="button" class="btn btn-default" ng-click="category = \'citation\'" ng-show="assets.citation">Zitate</button> <button type="button" class="btn btn-default" ng-click="category = \'story\'" ng-show="assets.story">Storyelemente</button> <button type="button" class="btn btn-default" ng-click="category = \'linklist\'" ng-show="assets.linklist">Linklisten</button> <div class="container" ng-init="getDefinitions(); category = \'definition\'"> <!-- search box --> <input type="search" class="form-control definitionsearch" placeholder="Search" ng-model="filterBox"> <ms-definitions-table ng-show="category === \'definition\'"></ms-definitions-table> <ms-citations-table ng-show="category === \'citation\'"></ms-citations-table> <ms-images-table ng-show="category === \'picture\'"></ms-images-table> <ms-stories-table ng-show="category === \'story\'"></ms-stories-table> <img class="plusposition" ng-click="onCreateDefinitionClick(category); showNewFocus = true; filterBox = \'\'" src="../images/plus.5ec55514.png" width="50"> </div>'),$templateCache.put("views/dialog_edit_file.html",'<form ng-init="getFile()"> <!--<div class="form-group">\n    <label for="authorInput">Author</label>\n    <input type="text" class="form-control" id="authorInput" placeholder="Author" ng-model="file.author" readonly>\n  </div>--> <div class="form-group"> <label for="titleInput">Title</label> <input type="text" class="form-control" id="titleInput" placeholder="Title" ng-model="file.title"> </div> <div class="form-group"> <label for="typeInput">Type</label> <select class="form-control" id="typeInput" ng-model="file.type"> <option ng-repeat="filetype in filetypes" value="{{filetype.type}}">{{ filetype.displayname }}</option> </select> </div> <!-- private checkbox --> <div class="form-group"> <label class="checkbox-inline"><input type="checkbox" ng-model="file.private">Private</label> </div> <!-- save button --> <button type="submit" class="btn btn-sm center-block bluebutton" ng-disabled="!file.title || !file.author || !file.type" ng-click="onSaveClick(file) || closeThisDialog()"> Save </button> </form>'),$templateCache.put("views/dialog_export.html",'<form ng-init="addTitle = true; addContentTable = true; addImages = true; addLinks = true; addDefinitions = true; isFolder = false"> <div class="form-group"> <label for="inputTitle">Filename</label> <input type="text" class="form-control" id="inputTitle" placeholder="export.html" ng-model="filename"> </div> <div id="export_options" ng-show="file.type === \'opOlat\'"> <div> <ms-checkbox ng-model="addTitle"></ms-checkbox> Add Title </div> <div> <ms-checkbox ng-model="addContentTable"></ms-checkbox> Add Table of Content </div> <div> <ms-checkbox ng-model="addImages"></ms-checkbox> Add Table of Images </div> <div> <ms-checkbox ng-model="addLinks"></ms-checkbox> Add Table of Links </div> <div> <ms-checkbox ng-model="addDefinitions"></ms-checkbox> Add Table of Definitions </div> <div> <ms-checkbox ng-model="isFolder"></ms-checkbox> Subfolder </div> </div> <button type="button" class="btn btn-default center-block bluebutton" ng-click="onDownloadConfirm(filename, addTitle, addContentTable, addImages, addLinks, addDefinitions, isFolder) || closeThisDialog()" ng-disabled="!filename"> Export </button> </form>'),$templateCache.put("views/dialog_history.html",'<div> <span class="tableheader">{{ archivedFiles[0].title }} by {{ archivedFiles[0].author }} - Archivierte Versionen</span> <scrollable> <!--<span ng-show="archivedFiles.length < 1">No archived versions exist for this file.</span>--> <!--archived files found for this document: {{ archivedFiles.length }}--> <table class="filegroup fullwidth historytable"> <colgroup> <col span="1" style="width: 25%"> <col span="1" style="width: 25%"> <col span="1" style="width: 25%"> <col span="1" style="width: 25%"> </colgroup> <tr class="version" ng-repeat="archivedFile in archivedFiles | orderBy: \'created_at\':true"> <!-- formatted date or "current" --> <td> {{ archivedFile.created_at | date: "dd.MM.yyyy HH:mm" : \'CEST\'}} <span ng-show="$index === 0">(current)</span> </td> <td> <span ng-show="!archivedFile.updated_by">changed by owner</span> <span ng-show="archivedFile.updated_by">changed by {{ archivedFile.updated_by }}</span> </td> <td> <!-- open as new file, visible fr everybody --> <button type="button" class="btn btn-default bluebutton nomargin" ng-click="onOpenAsNewFileClick(archivedFile); closeThisDialog()">Als neue Datei öffnen</button> </td> <td> <!-- revert file back to archived version, only visible for owner of file --> <button type="button" class="btn btn-default bluebutton nomargin" ng-click="onRevertFileClick(archivedFile); closeThisDialog()" ng-show="currentUser.name === archivedFile.author && $index > 0">Hierauf zurücksetzen</button> </td> </tr> </table> </scrollable> </div>'),$templateCache.put("views/dialog_new_file.html",'<form> <!--<div class="form-group">\n    <label for="authorInput">Author</label>\n    <input type="text" class="form-control" id="authorInput" placeholder="Author" ng-model="newFile.author" readonly ng-init="newFile.author = currentUser.name">\n  </div>--> <div class="form-group"> <label for="titleInput">Title</label> <input type="text" class="form-control" id="titleInput" placeholder="Title" ng-model="newFile.title"> </div> <div class="form-group"> <label for="typeInput">Type</label> <select class="form-control" id="typeInput" ng-model="newFile.type" ng-init="newFile.type = \'opOlat\'"> <option ng-repeat="filetype in filetypes" value="{{filetype.type}}">{{ filetype.displayname }}</option> </select> </div> <!-- public checkbox --> <div ng-init="newFile.private = false"> <ms-checkbox ng-model="newFile.private"></ms-checkbox> Private </div> <button type="submit" class="btn btn-default center-block bluebutton" ng-disabled="!newFile.title || !currentUser" ng-click="onCreateConfirm() || closeThisDialog()"> Create </button> </form>'),$templateCache.put("views/dialog_preview.html",'<h3>Preview</h3> <iframe src="{{ previewPath }}" class="preview"></iframe>'),$templateCache.put("views/dialog_users.html",'<h3>User management</h3> <div class="container" ng-init="getUsers()"> <div ng-repeat="user in users" class="row"> <div class="col-md-3"> {{ user.username }} </div> <!-- group selection  dropdown --> <div class="col-md-3"> <!--label for="userGroupSelect">Group</label>--> <select class="form-control" id="userGroupSelect" ng-model="user.group" ng-change="onUserChange(user)" ng-disabled="user.username === currentUser.name && currentUser.group === \'admin\'"> <option>admin</option> <option>user</option> </select> </div> <div class="col-md-3"> <button type="button" class="btn btn-default" ng-click="onDeleteUserClick(user._id)" ng-disabled="user.username === currentUser.name">delete</button> </div> </div> </div>'),$templateCache.put("views/editor-toolbar.html",'<div class="toolbarwrapper"> <!-- home button --> <button class="btn btn-default btn-sm home" ng-click="onFilesClick()"> <i class="fa fa-angle-left"></i> <span class="iconlabel">Dateiübersicht</span> </button> <div id="editor-tools" class="toolbar autowidth center"> <!-- undo and redo buttons --> <div class="btn-group" role="group"> <button class="btn btn-default btn-sm" data-toggle="tooltip" title="Undo (Ctrl + Z)" ng-click="onUndoClick()"> <i class="fa fa-undo"></i> </button> <button class="btn btn-default btn-sm" ng-click="onRedoClick()" data-toggle="tooltip" title="Redo"> <i class="fa fa-repeat"></i> </button> </div> <!-- help button--> <button target="_blank" class="btn btn-default btn-sm nav-link" role="button" data-toggle="tooltip" title="Markdown Help" ng-click="onHelpClick()"> Spickzettel </button> <!-- image, links & storyscript buttons --> <div class="btn-group marginleft" role="group"> <!-- image button --> <!--<button ng-show="isValidToolForType(file.type, \'imagetag\')" class="btn btn-default btn-sm" ng-click="onImageClick()" data-toggle="tooltip" title="Insert Image (Ctrl + I)">\n        Bild\n    </button>--> <!-- definition-button --> <button class="btn btn-default btn-sm" ng-click="onDefinitionClick()" ng-disabled="file.type === \'news\' && currentUser.group !== \'admin\'"> Anreichern </button> <!-- link button --> <!--<button ng-show="isValidToolForType(file.type, \'linktag\')" class="btn btn-default btn-sm" ng-click="onLinkClick()" data-toggle="tooltip" title="Ctrl + L">\n        Link\n    </button>--> <!-- storyscript button --> <!--<button ng-show="isValidToolForType(file.type, \'storytag\')" class="btn btn-default btn-sm" ng-click="onStoryScriptClick()" data-toggle="tooltip" title="Insert Storytag">\n        Story\n    </button>--> </div> <!-- export --> <button class="btn btn-default btn-sm marginleft" ng-click="onExportClick()"> Export </button> <!-- preview button --> <button ng-disabled="file.type !== \'prMainzed\' && file.type !== \'opOlat\' && file.type !== \'opMainzed\'" class="btn btn-default btn-sm" ng-click="onPreviewClick()" ng-disabled="editor.getValue().length < 1"> Vorschau </button> <!-- save button --> <div class="btn-group" role="group"> <button class="btn btn-default btn-sm pull-right" ng-click="onSaveClick()" data-toggle="tooltip" title="Save (Ctrl + S)" ng-disabled="!unsavedChanges"> Speichern </button> </div> <span class="save-text" ng-show="showSuccess === true">... saved!</span> <span class="save-text" ng-show="showError === true">... someting went wrong!</span> </div> <!-- filename --> <span class="filename grotesk">{{ file.title }} ({{ file.type }})</span> </div>'),$templateCache.put("views/editor.html",'<scrollable ng-init="init()"> <div id="codeMirrorEditor" ui-codemirror="{ onLoad : onCodeMirrorLoaded }" ui-codemirror-opts="editorOptions" ng-model="file.markdown" ng-change="onEditorChange()"></div> </scrollable> <ms-editor-toolbar></ms-editor-toolbar>'),$templateCache.put("views/files-panel.html",'<!-- search box --> <input type="search" placeholder="Search" ng-model="filesFilterBox"> <!-- show currently active filter --> <ms-filter-button></ms-filter-button> <div ng-repeat="(key, value) in files | filter: filesFilterBox | groupBy: \'type\'" ng-show="groupHasValidFiles(key)"> <!-- custom section names --> <span class="tableheader">{{ getName(key) }}</span> <table class="filegroup"> <colgroup> <col span="1" style="width: 60%"> <col span="1" style="width: 15%"> <col span="1" style="width: 10%"> <col span="1" style="width: 5%"> <col span="1" style="width: 10%"> </colgroup> <!-- only show documents of the current user or documents that are not private and nd are in the same group --> <tr ng-repeat="file in value | filter:currentFilter | orderBy:\'-updated_at\'" ng-show="file.author.toLowerCase() === currentUser.name.toLowerCase() || file.private === false"> <td class="colfilename"> <a ng-href="#/editor/{{file._id}}"> <span ng-show="file.active && file.active !== \'none\'" style="color: red; margin-right: 5px" ng-repeat="user in file.active track by $index">{{ user }}</span>{{ file.title }} </a> </td> <td> <button type="button" class="btn btn-link" ng-click="setFilter({ updated_at: file.updated_at })" ng-disabled="currentFilter[\'updatedAt\']"> {{ getFormattedDate(file.updatedAt) }} </button> </td> <td> <button ng-show="file.author === currentUser.name" type="button" class="btn btn-link" ng-click="setFilter({ author: file.author })" ng-disabled="currentFilter[\'author\']"> {{ "me" }} </button> <button ng-show="file.author !== currentUser.name" type="button" class="btn btn-link" ng-click="setFilter({ author: file.author })" ng-disabled="currentFilter[\'author\']"> {{ file.author.toLowerCase() }} </button> </td> <td class="colfilestate"> <button type="button" class="btn btn-link" ng-click="setFilter({ private: true })" ng-disabled="currentFilter[\'private\']"> <i ng-show="file.private" class="fa fa-lock icon-locked" aria-hidden="true" data-toggle="tooltip" title="Private Document. Not visible to other users!"></i> </button> </td> <td> <div class="dropdown pull-right" ng-init="checkIfArchivedFiles(file._id)"> <!-- check if archived verions exist --> <button ng-disabled="file.type === \'news\' && currentUser.group !== \'admin\'" class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> <span class="line"></span> <span class="line"></span> <span class="line"></span> </button> <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"> <!-- download --> <li> <a ng-href="#" target="_self" class="" ng-click="onDownloadClick(file._id)" data-toggle="tooltip" title="Download Markdown"> Download </a> </li> <!-- history, show only if exists --> <li ng-show="hasArchived.indexOf(file._id) > -1"> <a ng-click="onHistoryClick(file._id)" data-toggle="tooltip" title="Show History"> Frühere Versionen </a> </li> <!-- edit. only show when author --> <li> <a class="" ng-click="onEditClick(file._id)" data-toggle="tooltip" title="File Settings"> Editieren </a> </li> <!-- delete --> <li> <a class="" ng-click="onRemoveClick(file._id)" data-toggle="tooltip" title="File Settings"> Löschen </a> </li> </ul> </div> </td> </tr> </table> </div>'),$templateCache.put("views/files.html",'<div class="row files-top" ng-init="init()"> <div class="listcontainer"> <scrollable> <ms-files-panel class="filesection"></ms-files-panel> </scrollable> <!-- create new --> <div class="toolbarwrapper"> <div class="toolbar autowidth center"> <div class="displayuser"> <!-- admin button --> <button type="button" class="btn btn-default underline" ng-click="onUsersClick()" ng-show="group === \'admin\'"> Users </button> <span ng-show="currentUser"><span class="icon-maus"></span>maus version 0.6.1 / Logged in as {{ currentUser.name.toLowerCase() }}, </span> <button type="button" class="btn btn-default underline" ng-click="onLogoutClick()"> Logout </button> </div> </div> </div> </div> </div> <img class="plusposition" src="../images/plus.5ec55514.png" width="50" ng-click="onCreateNewFile()"> <!--<button class="btn btn-primary btn-sm" ng-click="onCreateNewFile()">New</button>-->'),$templateCache.put("views/filter-button.html",'<button ng-show="currentFilter[\'author\']" type="button" class="btn btn-default filterbutton grotesk" ng-click="onResetClick()"> <i class="fa fa-times" aria-hidden="true"></i> author: {{ currentFilter[\'author\'] }} </button> <button ng-show="currentFilter[\'private\']" type="button" class="btn btn-default filterbutton grotesk" ng-click="onResetClick()"> <i class="fa fa-times" aria-hidden="true"></i> private: {{ currentFilter[\'private\'] }} </button> <button ng-show="currentFilter[\'updated_at\']" type="button" class="btn btn-default filterbutton grotesk" ng-click="onResetClick()"> <i class="fa fa-times" aria-hidden="true"></i> date: {{ currentFilter[\'updated_at\'] }} </button>'),
$templateCache.put("views/images-table.html",'<table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 3%"><!-- insert shortcut button --> <col span="1" style="width: 15%"> <col span="1" style="width: 10%"> <col span="1" style="width: 20%"><!-- bildunterschrift --> <col span="1" style="width: 20%"> <col span="1" style="width: 10%"><!-- author --> </colgroup> <thead> <tr class="noborder"> <th></th> <th>Shortcut</th> <th>Alt</th> <th>Bildunterschrift</th> <th>Lizenz</th> <th>Quelle</th> <th>Author</th> <th></th> </tr> </thead> </table> <scrollable> <table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 3%"> <col span="1" style="width: 15%"> <col span="1" style="width: 10%"> <col span="1" style="width: 20%"><!-- bildunterschrift --> <col span="1" style="width: 20%"> <col span="1" style="width: 10%"><!-- author --> </colgroup> <tbody> <!--<tr ng-repeat="definition in definitions | filter:{ filetype: file.type }| filter:filterBox | orderBy: \'-updated_at\'">--> <tr ng-repeat="definition in definitions | filter: {category: category, filetype: file.type} | filter:filterBox |  orderBy: \'-updated_at\'"> <td> <a ng-click="closeThisDialog(); addImage(definition)" class="choose"> <i class="fa fa-play" aria-hidden="true"></i> </a> </td> <td> <!-- new definition --> <textarea ng-show="showNewFocus && $index === 0 && !definition._id" type="text" placeholder="Word" ng-model="definition.word" class="form-control" ng-blur="showNewFocus = false" focus-on-visibility></textarea> <!-- existing definition --> <ms-table-input ng-show="!showNewFocus || $index > 0 || definition._id" ng-model="definition.word"></ms-table-input> </td> <td> <ms-table-input ng-model="definition.title"></ms-table-input> </td> <td> <ms-table-input ng-model="definition.text"></ms-table-input> </td> <!-- license --> <td> <!--<select ng-model="definition" name="hall" value="3">\n                  <option>CC BY-NC-SA 4.0</option>\n                  <option>???</option>\n                  <option>???</option>\n\n              </select>--> <ms-table-input ng-model="definition.license"></ms-table-input> </td> <td> <input type="text" placeholder="URL" ng-model="definition.url" ng-class="urlClass" ng-init="urlClass = [\'def-table-entries\']" ng-blur="urlClass = [\'def-table-entries\']" ng-focus="urlClass = [\'form-control\']" ng-change="onDefinitionChange()"> </td> <td> <input type="text" placeholder="Author" ng-model="definition.author" ng-class="authorClass" ng-init="authorClass = [\'def-table-entries\']" ng-blur="authorClass = [\'def-table-entries\']" ng-focus="authorClass = [\'form-control\']" ng-change="onDefinitionChange()"> </td> <!-- remove --> <td ng-show="definition._id"> <button type="button" class="btn btn-default" ng-click="onRemoveDefinitionClick(definition._id)"> <span class="icon-trash"></span> </button> </td> </tr><!-- end repeat --> </tbody> </table> </scrollable>'),$templateCache.put("views/login.html",'<div class="col-md-3" ng-show="!showSignup"> <form> <div class="form-group"> <input type="text" class="form-control" placeholder="Username" ng-model="username"> </div> <div class="form-group"> <input type="password" class="form-control" placeholder="Password" ng-model="password"> </div> <!-- login button --> <button id="login-button" type="button" class="btn btn-default" ng-click="onLoginSubmit()" ng-disabled="!username || !password || validating">Login</button> <span ng-show="showError" class="text-danger" ng-bind="showError"></span> <span ng-show="showSuccess" class="text-success">Success!</span> </form> </div> <span ng-show="!showSignup"> or <!-- signup button --> <button type="button" class="btn btn-default btn-sm" ng-click="showSignup = true; username = \'\'; password=\'\'">signup</button> </span> <div class="col-md-3" ng-show="showSignup"> <form> <div class="form-group"> <input type="text" class="form-control" placeholder="Enter username" ng-model="username"> </div> <div class="form-group"> <input type="password" class="form-control" placeholder="Enter password" ng-model="password"> </div> <div class="form-group"> <input type="password" class="form-control" placeholder="Confirm password" ng-model="passwordConfirm"> </div> <button id="signup-button" type="button" class="btn btn-default" ng-click="onSignupSubmit()" ng-disabled="!username || !password || validating">Signup</button> <span ng-show="showError" class="text-danger" ng-bind="showError"></span> <span ng-show="showSuccess" class="text-success">Success!</span> </form> <button type="button" class="btn btn-default btn-sm" ng-click="showSignup = false">back</button> </div>'),$templateCache.put("views/stories-table.html",'<table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 5%"> <col span="1" style="width: 20%"> <col span="1" style="width: 70%"> <col span="1" style="width: 5%"> </colgroup> <thead> <tr class="noborder"> <th></th> <th>Shortcut</th> <th>Story content</th> <th></th> </tr> </thead> </table> <scrollable> <table class="filegroup nomargin fullwidth"> <colgroup> <col span="1" style="width: 5%"> <col span="1" style="width: 20%"> <col span="1" style="width: 70%"> <col span="1" style="width: 5%"> </colgroup> <tbody> <!--<tr ng-repeat="definition in definitions | filter:{ filetype: file.type }| filter:filterBox | orderBy: \'-updated_at\'">--> <tr ng-repeat="definition in definitions | filter: {category: category, filetype: file.type} | filter:filterBox |  orderBy: \'-updated_at\'"> <td> <a ng-click="closeThisDialog(); addStory(definition)" class="choose"> <i class="fa fa-play" aria-hidden="true"></i> </a> </td> <td> <!-- new definition --> <textarea ng-show="showNewFocus && $index === 0 && !definition._id" type="text" placeholder="Word" ng-model="definition.word" class="form-control" ng-blur="showNewFocus = false" focus-on-visibility></textarea> <!-- existing definition --> <ms-table-input ng-show="!showNewFocus || $index > 0 || definition._id" ng-model="definition.word"></ms-table-input> </td> <td> <ms-table-input ng-model="definition.text"></ms-table-input> </td> <!-- remove --> <td ng-show="definition._id"> <button type="button" class="btn btn-default" ng-click="onRemoveDefinitionClick(definition._id)"> <span class="icon-trash"></span> </button> </td> </tr><!-- end repeat --> </tbody> </table> </scrollable>'),$templateCache.put("views/table-input.html",'<!-- existing definition, inactive --><!--<span class="clickspan" ng-show="!showTextarea" ng-click="showTextarea = true">{{ bindModel }}</span> --><!-- existing definition, active --> <textarea type="text" placeholder="..." ng-model="bindModel" focus-on-visibility></textarea> <!-- new empty definition, active -->')}]);